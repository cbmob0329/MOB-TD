<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MOBタワーディフェンス プロトタイプ</title>
<style>
  body { margin:0; background:#000; overflow:hidden; }
  canvas { background:#222; display:block; margin:0 auto; }
  #ui {
    position:fixed; bottom:10px; left:50%; transform:translateX(-50%);
    display:flex; gap:10px;
  }
  button { padding:8px 14px; font-size:14px; }
</style>
</head>
<body>
<canvas id="game" width="960" height="540"></canvas>
<div id="ui">
  <button onclick="spawn('dan')">MOB段ボール (50)</button>
  <button onclick="spawn('fighter')">MOBファイター (120)</button>
</div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// 画像読み込み
const images = {};
function loadImage(name, src) {
  images[name] = new Image();
  images[name].src = src;
}
loadImage("bg", "sora.png");
loadImage("ground", "doro.png");
loadImage("tower1", "T1.png");
loadImage("tower2", "T2.png");

// MOB段ボール
loadImage("dan_stand", "C1.png");
loadImage("dan_walk1", "C2.png");
loadImage("dan_walk2", "C3.png");
loadImage("dan_attack", "C4.png");

// MOBファイター
loadImage("f_stand", "EN1-1.png");
loadImage("f_walk1", "EN1-2.png");
loadImage("f_walk2", "EN1-3.png");
loadImage("f_attack1", "EN1-4.png");
loadImage("f_attack2", "EN1-5.png");

// ゲーム変数
let coins = 500;
const allies = [];
const enemyTower = {x:800, hp:2000};
const groundY = 400;

// ユニット定義
const unitDefs = {
  dan: {
    name:"MOB段ボール", hp:150, atk:20, interval:1000, speed:3, cost:50,
    walk:["dan_walk1","dan_walk2"], attack:["dan_attack"]
  },
  fighter: {
    name:"MOBファイター", hp:120, atk:30, interval:700, speed:5, cost:120,
    walk:["f_walk1","f_walk2"], attack:["f_attack1","f_attack2"]
  }
};

// 出撃
function spawn(type){
  const def = unitDefs[type];
  if(coins>=def.cost){
    coins-=def.cost;
    allies.push({
      ...def, x:100, y:groundY, frame:0, lastAtk:0, hp:def.hp
    });
  }
}

// 更新
function update(dt){
  for(const u of allies){
    // 攻撃可能距離に到達？
    if(u.x+40 >= enemyTower.x){
      if(Date.now()-u.lastAtk > u.interval){
        enemyTower.hp -= u.atk;
        u.lastAtk = Date.now();
      }
    }else{
      u.x += u.speed*dt*0.1;
    }
  }
}

// 描画
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(images.bg,0,0,canvas.width,canvas.height);
  ctx.drawImage(images.ground,0,groundY,canvas.width,140);
  ctx.drawImage(images.tower1,20,groundY-150,120,150);
  ctx.drawImage(images.tower2,enemyTower.x,groundY-150,120,150);

  for(const u of allies){
    ctx.drawImage(images[u.walk[Math.floor(Date.now()/200)%u.walk.length]], u.x, u.y-100, 80,100);
  }

  // UI
  ctx.fillStyle="white";
  ctx.fillText("コイン: "+coins,20,20);
  ctx.fillText("敵タワーHP: "+enemyTower.hp,20,40);
}

// メインループ
let last=performance.now();
function loop(now){
  const dt=now-last; last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
loop(last);
</script>
</body>
</html>
